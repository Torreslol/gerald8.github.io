---
layout: post
title: "GCD Tips"
author: "Gerald"
---

- 不要使用太多的基于 global 的队列。过多的 queues 同时处于 active 状态容易导致线程爆炸。队列应该按具体的任务类型分类（gui，存储，后台任务）等。

- 优先串行，然后找到性能瓶颈（如果存在）-> 找到原因 -> 如果并发可以解决，使用并发。尽量重用队列，大多数应用不应该存在大于 3 或 4 个队列。

<!--more-->
- 队列可以依附其他队列，这些是可扩展的队列。

- 不要使用 dispatch_get_global_queue()， 同第一条。

- dispatch_async() 大概率会新建线程，耗时较小的任务不要使用，以造成额外的上下文切换的开销。

- 并发运行时，各个 work item 如果有资源竞争，性能会急剧下降。（比如 锁， 共享内存，io，malloc 等）

- 使用一些设计的更好的锁，比如 os_unnfair_lock （不存在优先级反转的自旋锁）。更好的优先级，更少的上下文切换成本。

- 异步嵌套引入的代码复杂度需要考虑，同步代码更为清晰。

- 异步队列不像同步队列有经过优化，所以不是必要不要过度优化。

  